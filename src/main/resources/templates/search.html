<!DOCTYPE html>
<html lang="en" xmlns="https://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<head>
    <title>Поисковик</title>
    <script th:src="@{/js/main.js}"></script>
    <script th:src="@{/js/themes.js}"></script>
    <script th:src="@{/js/requests.js}"></script>
    <script th:src="@{/js/dropzone.js}"></script>
    <script th:src="@{/js/search.js}"></script>
    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
</head>

<body th:data-is-admin="${isAdmin}">
<div class="header-container">
    <h1>Поисковик</h1>
    <div class="button-list">
        <button class="settings-button" onclick="openSettingsDialog()" type="button">Настройки</button>
        <div th:if="${isAdmin}">
            <button class="settings-button" onclick="openUploadDialog()">Загрузить файл</button>
        </div>
        <button class="settings-button" id="search-button">Искать</button>
    </div>
</div>

<div th:replace="~{::pagination}"></div>

<table id="file-paths">
    <thead>
    <tr>
        <th>
            <a class="sort">
                Дец. номер
            </a>
            <input class="search-input" data-search-field="decNumber" id="decNumber" type="text"></th>
        <th>
            <a class="sort">
                Наименование
            </a>
            <input class="search-input" data-search-field="deviceName" id="deviceName" type="text"></th>
        <th>
            <a class="sort">
                Тип документа
            </a>
            <input class="search-input" data-search-field="documentType" id="documentType" type="text"></th>
        <th>
            <a class="sort">
                Прим. устройства
            </a>
            <input class="search-input" data-search-field="usedDevices" id="usedDevices" type="text"></th>
        <th>
            <a class="sort">
                Проект
            </a>
            <input class="search-input" data-search-field="project" id="project" type="text"></th>
        <th>
            <a class="sort">Дата внес.</a>
            <input class="search-input" data-search-field="creationTime" id="creationTime" type="text"/>
        </th>
        <th>
            <a class="sort">Дата изм.</a>
            <input class="search-input" data-search-field="lastModified" id="lastModified" type="text"/>
        </th>
        <th>
            <a class="sort">
                Кем внесено
            </a>
            <input class="search-input" data-search-field="user" id="user" type="text"></th>
        </th>
        <th>
            <a class="sort">
                Местоположение
            </a>
            <input class="search-input" data-search-field="location" id="location" type="text"></th>
        <th>
            <a class="sort">
                Инвентарный номер
            </a>
            <input class="search-input" data-search-field="inventoryNumber" id="inventoryNumber" type="text">
        </th>
        <th></th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="file : ${fileInfos}">
        <td><span th:text="${file.decNumber}"></span></td>
        <td><span th:text="${file.deviceName}"></span></td>
        <td><span th:text="${file.documentType}"></span></td>
        <td><span th:text="${file.usedDevices}"></span></td>
        <td><span th:text="${file.project}"></span></td>
        <td><span th:text="${file.creationTime}"></span></td>
        <td><span th:text="${file.lastModified}"></span></td>
        <td><span th:text="${file.user.username}"></span></td>
        <td><span th:text="${file.location}"></span></td>
        <td><span th:text="${file.inventoryNumber}"></span></td>
        <td>
            <div class="dropdown">
                <button class="options-button" onclick="openDropdown(event)">...</button>
                <div class="dropdown-content" id="dropdown-content" th:data-id="${file.id}"
                     th:data-location="${file.location}">
                    <button class="custom-dropdown-button" id="downloadButton">Скачать</button>
                    <button class="custom-dropdown-button" id="copyButton">Копировать путь</button>
                    <div th:if="${isAdmin}">
                        <button class="custom-dropdown-button" id="deleteButton">Удалить</button>
                        <button class="custom-dropdown-button" id="replaceButton">Заменить</button>
                        <button class="custom-dropdown-button" id="updateButton">Редактировать</button>
                    </div>
                    <button class="custom-dropdown-button" id="historyButton">История</button>
                </div>
            </div>

            <div class="dialog-box" id="replaceDialog">
                <div class="dialog-content">
                    <h2>Замена файла</h2>
                    <form action="/api/replace" enctype="multipart/form-data" method="post">
                        <input name="filePath" th:value="${file.location}" type="hidden"/>
                        <div class="form-group">
                            <div class="drop-zone-container">
                                <div class="drop-zone">
                                    <input id="file-input" name="file" type="file"/>
                                    <label class="drop-zone__prompt" for="file-input">Выберите или переместите файл
                                        сюда</label>
                                    <span id="file-name"></span>
                                </div>
                            </div>
                            <div class="buttons">
                                <button class="custom-button" type="submit">Заменить</button>
                                <button class="custom-button" onclick="closeDialog()" type="button">Отменить</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="dialog-box" id="fileHistoryDialog" style="display: none;">
                <div class="dialog-content">
                    <h2>История файла</h2>
                    <div class="file-history-list" id="fileHistoryList">
                        <!-- files -->
                    </div>
                    <button class="custom-button" onclick="closeFileHistoryDialog()" type="button">Закрыть</button>
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>

<div class="pagination" th:fragment="pagination" th:if="${fileInfos.size() gt 0}">
    <span th:if="${page>0}">
        <a th:href="@{/search(page=0)}">«</a>
    </span>

    <span th:each="i : ${pageNumbers}">
        <a th:classappend="${i == page} ? 'selected-page'"
           th:href="@{/search(page=${i})}" th:if="${i >= 0 && i < totalPages}">
            <span th:text="${i + 1}"></span>
        </a>
    </span>

    <span th:if="${page < totalPages - 1}">
        <a th:href="@{/search(page=${totalPages - 1})}">»</a>
    </span>
</div>

<div class="dialog-box" id="uploadDialog" style="display: none;">
    <div class="dialog-content">
        <div class="settings-section margin-bottom">
            <h2>Загрузка файла</h2>
            <form id="uploadForm">
                <div class="input-group margin-bottom">
                    <label for="uploadDecNumber">Децимальный номер:</label>
                    <input id="uploadDecNumber" name="decNumber" required type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="uploadDeviceName">Наименование устройства:</label>
                    <input id="uploadDeviceName" name="deviceName" required type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="uploadDocumentType">Тип документа:</label>
                    <input id="uploadDocumentType" name="documentType" required type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="uploadUsedDevices">Применяемые устройства (через запятую):</label>
                    <input id="uploadUsedDevices" name="usedDevices" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="uploadProject">Проект:</label>
                    <input id="uploadProject" name="project" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="uploadInventoryNumber">Инвентарный номер:</label>
                    <input id="uploadInventoryNumber" name="inventoryNumber" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="uploadLocation">Путь до документа:</label>
                    <input id="uploadLocation" name="location" type="text">
                </div>
                <div class="form-group margin-bottom">
                    <label for="fileInput">Выберите файл:</label>
                    <input id="fileInput" name="file" required type="file">
                </div>
                <div class="margin-bottom" id="error-message" style="color: red; display: none;"></div>
                <div class="button-group margin-bottom">
                    <button class="custom-button" onclick="submitForm()" type="button">Загрузить</button>
                </div>
                <button class="custom-button" onclick="closeUploadDialog()" type="button">Отменить</button>
            </form>
        </div>
    </div>
</div>

<div class="dialog-box" id="updateDialog" style="display: none;">
    <div class="dialog-content">
        <div class="settings-section margin-bottom">
            <h2>Изменение информации о файле</h2>
            <form action="/api/update" enctype="multipart/form-data" id="updateForm" method="post">
                <input id="fileId" name="id" type="hidden">

                <div class="input-group margin-bottom">
                    <label for="updateDecNumber">Децимальный номер:</label>
                    <input id="updateDecNumber" name="decNumber" required type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateDeviceName">Наименование устройства:</label>
                    <input id="updateDeviceName" name="deviceName" required type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateDocumentType">Тип документа:</label>
                    <input id="updateDocumentType" name="documentType" required type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateUsedDevices">Применяемые устройства:</label>
                    <input id="updateUsedDevices" name="usedDevices" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateProject">Проект:</label>
                    <input id="updateProject" name="project" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateInventoryNumber">Инвентарный номер:</label>
                    <input id="updateInventoryNumber" name="inventoryNumber" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateLocation">Путь до документа:</label>
                    <input id="updateLocation" name="location" type="text">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateLastModified">Дата последнего изменения:</label>
                    <input id="updateLastModified" name="lastModified" required type="datetime-local">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateCreationTime">Дата создания:</label>
                    <input id="updateCreationTime" name="creationTime" required type="datetime-local">
                </div>
                <div class="input-group margin-bottom">
                    <label for="updateUserName">Имя пользователя:</label>
                    <input id="updateUserName" name="userName" required type="text">
                </div>
                <div class="button-group margin-bottom">
                    <button class="custom-button" type="submit">Сохранить изменения</button>
                </div>
                <button class="custom-button" onclick="closeUpdateDialog()" type="button">Отменить</button>
            </form>
        </div>
    </div>
</div>

<div class="dialog-box" id="settingsDialog">
    <div class="dialog-content">
        <h2>Настройки</h2>
        <div class="settings-section margin-bottom">
            <h3>Темы</h3>
            <div class="theme-switcher margin-bottom">
                <label class="theme-dropdown-label" for="theme-dropdown">Тема:</label>
                <select class="theme-dropdown" id="theme-dropdown" onchange="changeTheme()">
                    <option value="system">Системная</option>
                    <option value="dark">Тёмная</option>
                    <option value="light">Светлая</option>
                </select>
            </div>
            <div class="input-group margin-bottom">
                <label class="theme-dropdown-label" for="colorPicker">Цвет:</label>
                <select class="theme-dropdown" id="colorPicker" onchange="handleAccentColorPicker()">
                    <option value="">Выберите цвет</option>
                    <option value="#a14242">Темно-красный</option>
                    <option value="#588163">Оливково-зеленый</option>
                    <option value="#6e57d2">Лавандовый</option>
                    <option value="#ff8a22">Оранжевый</option>
                    <option value="#e00a97">Маджента</option>
                    <option value="#843c54">Коричневый</option>
                    <option value="#1a4f76">Темно-синий</option>
                    <option value="#ffd700">Золотой</option>
                    <option value="#8b4513">Седло коричневый</option>
                    <option value="#4682b4">Стальной голубой</option>
                    <option value="#ff69b4">Ярко-розовый</option>
                    <option value="#20b2aa">Светло-морской зеленый</option>
                </select>
            </div>
            <div class="input-group margin-bottom">
                <label for="accentColor">Сторонний цвет (HEX):</label>
                <input id="accentColor" placeholder="Enter color" type="text">
            </div>
            <div class="button-group">
                <button class="custom-button" onclick="handleAccentColorHex()" type="button">Применить цвет</button>
                <button class="custom-button" onclick="resetAccentColor()">Сбросить цвет</button>
            </div>
        </div>
        <div class="margin-bottom" th:if="${isAdmin}">
            <h3>Admin</h3>
            <div class="input-group">
                <label for="userName">Дать админку:</label>
                <input id="username" placeholder="Введите имя" type="text">
            </div>
            <div class="button-group">
                <button class="custom-button" onclick="grantAdmin()" type="button">Применить</button>
            </div>
        </div>
        <div class="margin-bottom" th:if="${isAdmin}">
            <h3>Системное</h3>
            <div class="input-group">
                <label for="searcherPath">Путь для поиска:</label>
                <input id="searcherPath" placeholder="/путь/для/поиска" th:value="${searchPath}" type="text">
            </div>
            <div class="button-group margin-bottom">
                <button class="custom-button" onclick="applyCustomPath()" type="button">Применить</button>
            </div>
            <button class="custom-button" onclick="resetDatabase()" type="button">Сбросить все базы</button>
            <button class="custom-button" onclick="resetFileDatabase()" type="button">Сбросить базу файлов</button>
            <button class="custom-button" onclick="restartServer()" type="button">Перезапустить сервер</button>
        </div>
        <div class="account-credentials margin-bottom">
            <h3>Аккаунт</h3>
            <div class="input-group">
                <label for="nickname">Имя:</label>
                <input id="nickname" th:placeholder="${nickname}" type="text">
            </div>
            <div class="input-group">
                <label for="old-password">Старый пароль:</label>
                <input id="old-password" placeholder="Старый пароль" type="password">
            </div>
            <div class="input-group">
                <label for="new-password">Новый пароль:</label>
                <input id="new-password" placeholder="Новый пароль" type="password">
            </div>
            <div class="button-group">
                <button class="custom-button" onclick="changePassword()" type="button">Применить изменения</button>
            </div>
            <button class="custom-button" onclick="logout()" type="button">Выйти из аккаунта</button>
        </div>
        <button class="custom-button" onclick="closeSettingsDialog()" type="button">Закрыть</button>
    </div>
</div>

</body>
</html>